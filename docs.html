<!DOCTYPE html>
<html lang="en">

<head>

  <title>PyAlgosim Documentation - python-built algorithmic trading backtester.</title>
  <link rel="icon" href="images/favicon.png" />

  <!-- Tag for better mobile display -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="PyAlgosim - A simple Python-built backtester for algorithmic stock trading.">

  <link href="stylesheets/materialize.min.css" type="text/css" rel="stylesheet"/>

  <link rel="stylesheet" href="stylesheets/highlight/dracula.css">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

  <link href="stylesheets/styles.css" type="text/css" rel="stylesheet"/>

</head>

<body>

  <nav id="navbar">
    <a href="/" id="logo"><img src="images/paslogo.svg" /></a>
    <ul>
      <li>
        <a href="getting-started.html">Getting started</a>
      </li>
      <li>
        <a href="docs.html">Documentation</a>
      </li>
      <li>
        <a href="https://github.com/DHDaniel/PyAlgosim/releases/latest" class="btn waves-effect waves-light">Download</a>
      </li>
    </ul>
    <button id="menu-toggle" class="hide-on-desktop"><i class="fa fa-bars" aria-hidden="true"></i></button>
  </nav>

  <header id="top-banner">
    <h1>Documentation</h1>
  </header>

  <div id="content">
    <div class="container">
      <div class="row">

        <div class="col s12 m8">
          <h1 id="pyalgosimthesimulator">PyAlgosim, the simulator</h1>

<p>PyAlgosim is the module that takes care of running the algorithm that you wish to backtest. Using it is very simple and intuitive. First, you must import the module into your program - <strong>note that your program should be created in the same directory as the PyAlgosim.py file for the program to properly communicate with the generated database and ticker file</strong>.</p>

<pre><code class="python language-python">import PyAlgosim
</code></pre>

<h2 id="thepyalgosimapi">The PyAlgosim API</h2>

<h4 id="_class_pyalgosimpyalgosim_account__db_path__ticker_list_path__variables_"><em>class</em> PyAlgosim.PyAlgosim(<em>account</em>, [<em>db_path<em>, </em>ticker_list_path</em>, <em>variables</em>])</h4>

<p>This method initializes the PyAlgosim simulator. It returns an object that will function as the backtester for your algorithm.</p>

<p><strong>account</strong> - a PyBank object. The trading account that you wish to use during the simulator.
<strong>db<em>path</strong> (optional) - the path to the database file you are using. Should be a <code>string</code>. If you used the initialize.py script and are running the program from PyAlgosim.py 's directory, then you shouldn't have to set this explicitly. Defaults to <code>./utils/stocks.db</code>.
<strong>ticker</em>list_path</strong> (optional) - the path to the ticker list file that should have been generated during the initialize.py script. Should be a <code>string</code>. Again, if you followed the initial setup instructions, you shouldn't have to explicitly set this. Defaults to <code>./utils/tickers.json</code>.
<strong>variables</strong> (optional) - an dictionary "template" (dictionary with empty fields) with any optional variables that you want your algorithm to have access to during the simulation. For example, the dictionary could store recurring averages, statistics, record highs and lows, etc. Defaults to <code>None</code>.</p>

<p>For example:</p>

<pre><code class="python language-python">import PyAlgosim
import PyBank

trade_account = PyBank.Account()

# this will use all of the default configuration, assuming all files have been kept in their original place
backtester = PyAlgosim.PyAlgosim(trade_account)

# this uses custom configuration for the stock database and the ticker list json file
backtester = PyAlgosim.PyAlgosim(trade_account, db_path="/some/other/path/mydata.db", ticker_list_path="/some/other/path/mytickers.json")

# this uses a variables dictionary, for potentially calculating a simple moving average for 50 days and the highest and lowest prices of the stock. Note that it is a "template" in the sense that it is empty - it will be provided exactly like that at the start of backtesting each stock.
my_variables = {
    highest_price = 0
    lowest_price = 0
    past_50_prices = []
}
backtester = PyAlgosim.PyAlgosim(trade_account, variables=my_variables)
</code></pre>

<h4 id="_classmethod_pyalgosimsimulate_algorithm__time_start__time_end_"><em>classmethod</em> PyAlgosim.simulate(<em>algorithm</em>[, <em>time_start</em>, <em>time_end</em>])</h4>

<p>This method performs the backtesting on the algorithm provided, using the data specified in <code>time_start</code> and <code>time_end</code>.</p>

<p><strong>algorithm</strong> - the name of the algorithm (function) that you wish to backtest. The function provided as an algorithm must take in the following variables in the order specified:</p>

<ul>
<li><p>A <strong>stock data</strong> dictionary that contains information about the stock being processed. The object will contain the following properties:</p>

<ul>
<li><strong>date</strong> - an integer of the form YYYYMMDD. The historical date of the data.</li>

<li><strong>price</strong> - a float. The current price of the stock.</li>

<li><strong>ticker</strong> - a string containing the ticker of the stock.</li></ul></li>

<li><p>A <strong>PyBank.Account()</strong> object, which will be the account you pass as an argument to PyAlgosim. The algorithm can access the account using this parameter.</p></li>

<li><p>A <strong>variables dictionary</strong>, which will be the variables template dictionary that you provide PyAlgosim. The template will be used at the start of backtesting for each ticker (it will not remain the same across <em>all</em> tickers, just the ticker that is being simulated at the time. Keep this in mind).</p></li>
</ul>

<p><strong>time<em>start, time</em>end</strong> - optional parameters to specify the time to start and end the backtesting. They should be <strong>datetime</strong> objects within the range of the data being used. If they exceed the ranges, or the date doesn't exist (e.g the market was closed on the date), then PyAlgosim will just use the closest date to the one specified. The range of data in the database is from <strong>January 2nd, 1998 to August 9th, 2013</strong>.</p>

<p>Example uses:</p>

<pre><code class="python language-python">import PyAlgosim
import PyBank
import datetime

trade_acc = PyBank.Account()
backtester = PyAlgosim.PyAlgosim(trade_acc)

# this algorithm checks to see if you currently own the stock, and if you have enough money to buy one share of the stock. It then buys one share if the conditions are met.
def algorithm(stock, account, variables):
    if stock["ticker"] not in account.stocks_owned and account.funds - (stock["price"] + account.TRANSACTION_FEE) &gt; 0:
        account.buy_stock(stock["ticker"], 1)

# Here, the algorithm is passed to the simulate() method. Only a start date is provided.
backtester.simulate(algorithm, datetime.date(2008, 1, 1) )
</code></pre>

<hr />

<h1 id="pybankthetradingaccount">PyBank, the trading account</h1>

<p>The PyBank module allows you to simulate a trading account, working together with the PyAlgosim module. It is what you will use to buy stock, sell stock, and other things you might to in a real-life trading account. The API is simple and intuitive to use.</p>

<p>It should be noted that the PyBank module cannot be used on its own. It should be used in conjunction with the PyAlgosim module for the backtesting to work properly.</p>

<h2 id="thepybankapi">The PyBank API</h2>

<h4 id="_class_pybankaccount_funds100000__transaction_fee699_"><em>class</em> PyBank.Account([<em>funds=100000</em>, <em>transaction_fee=6.99</em>])</h4>

<p>Returns an Account object, which you can perform various actions on, like in a trading account. Takes in two optional arguments:</p>

<p><strong>funds</strong> - float that defaults to 100,000. This is the initial funds that you wish the account to start out with.
<strong>transaction_fee</strong> - float that defaults to 6.99. This is the value of the transaction fees charged by the trading account (charged on every trade you perform).</p>

<pre><code class="python language-python">import PyBank

# creating an account with different initial funds and transaction fee
account = PyBank.Account(funds=10000, transaction_fee=9.99)
</code></pre>

<h4 id="_classmethod_accountbuy_stock_ticker__quantity_"><em>classmethod</em> Account.buy_stock(<em>ticker</em>, <em>quantity</em>)</h4>

<p>Method to buy a stock. An error will be thrown if you attempt to buy more shares than what your funds allow you to.</p>

<p><strong>ticker</strong> - a <code>string</code> specifying the ticker symbol, e.g <code>"AAPL"</code>.
<strong>quantity</strong> - an <code>int</code> specifying the number of shares to buy.</p>

<h4 id="_classmethod_accountsell_stock_ticker__quantity_"><em>classmethod</em> Account.sell_stock(<em>ticker</em>, <em>quantity</em>)</h4>

<p>Method to sell a stock. An error will be thrown if you attempt to sell a stock that you do not own, or attempt to sell too much of a stock.</p>

<p><strong>ticker</strong> - a <code>string</code> specifying the ticker symbol, e.g <code>"AAPL"</code>.
<strong>quantity</strong> - an <code>int</code> specifying the number of shares to buy. Alternatively, you can pass the string <code>"all"</code> to sell all the stock you own of that ticker.</p>

<h4 id="_classmethod_accounttrailing_stop_ticker__quantity__points__percentagefalse_"><em>classmethod</em> Account.trailing_stop(<em>ticker</em>, <em>quantity</em>, <em>points</em>[, <em>percentage=False</em>])</h4>

<p>Method to set a trailing stop order on a stock, selling it when it goes below a certain point. A more detailed explanation of how a trailing stop works can be found <a href="http://www.investopedia.com/terms/t/trailingstop.asp">here</a>.</p>

<p><strong>ticker</strong> - a <code>string</code> specifying the stock to place the order on. E.g <code>"AAPL"</code>.
<strong>quantity</strong> - an <code>int</code> specifying the amount of stock to sell.
<strong>points</strong> - a <code>float</code> sepcifying the number of points that the stock can fall before the sell order executing. For example, setting this to <code>1</code> would mean that a stock priced at <code>101</code> would sell if it dropped to <code>100</code>.
<strong>percentage</strong> - optional, defaults to <code>False</code>. Indicates whether the <strong>points</strong> parameter should be treated as a percentage or not i.e the stock would need to fall by the percentage specified for it to sell.</p>

<p><em><strong>Note</strong></em>: If you attempt to place two trailing stop orders on the same stock, they will be merged into one - the latest one placed.</p>

<p>Examples using the previous methods:</p>

<pre><code class="python language-python"># Note: all the operations that the account can do only work inside the algorithm inside PyAlgosim (it does not have the relevant data if used outside of PyAlgosim). However, they are shown outside of PyAlgosim here for illustration purposes.

import PyBank

account = PyBank.Account()

# buy 100 shares of Apple
account.buy_stock("AAPL", 100)

# sell those 100 shares - way #1
account.sell_stock("AAPL", 100)
# sell those 100 shares - way #2
account.sell_stock("AAPL", "all")


account.buy_stock("AAPL", 100)
# this indicates the account to sell the stock if it drops 5% in price.
account.trailing_stop("AAPL", 100, 5, percentage=True)
</code></pre>

<h4 id="_classmethod_accountsell_all"><em>classmethod</em> Account.sell_all()</h4>

<p>Sells all the stocks owned.</p>

<h4 id="_classmethod_accountreportverbosefalse"><em>classmethod</em> Account.report([verbose=False])</h4>

<p>Print out a report to the console on the trading activities of the account at that moment in time. It presents information such as the total return (based on the value of stocks held and funds in the account), average market return during that same time period, and number of transactions. If <strong>verbose</strong> is set to <code>True</code>, each stock currently owned by the account is printed to the console, with the average profit made reported on each one.</p>

<h1 id="pyalgosimandpybankputtingittogether">PyAlgosim and PyBank: putting it together</h1>

<p>The two modules are used in conjunction to perform backtesting on algorithms. The following examples will illustrate how to do this.</p>

<h2 id="creatingatradingalgorithm">Creating a trading algorithm</h2>

<p>When creating your trading algorithm, you must keep a few things in mind for everything to work properly. Specifically,</p>

<ul>
<li>Always checking whether you have enough money to buy the stock.</li>

<li>Correctly using the data provided.</li>

<li>Understand how the <code>variables</code> dictionary works</li>
</ul>

<p>If you make a purchase which you don't have enough money for, the program will raise an error and stop. For your trading strategy to work, you do not want this. Furthermore, you should keep in mind how the backtesting works. The trading algorithm runs separately for each stock (it will only have access to one ticker at a time). When the trading algorithm begins running on any one of the tickers, the template dictionary variable (if provided) will be available to the algorithm. This variable is <strong>separate</strong> for each stock - you will not have access to the variable dictionary of other stocks.</p>

<pre><code class="python language-python">import PyBank
import PyAlgosim

# template dictionary for variables
myvariables = {
    "high" : float("-inf"),
    "low" : float("inf")
}

account = PyBank.Account()
backtester = PyAlgosim.PyAlgosim(account, variables=myvariables)

# this is an example of keeping track of highs and lows in the variables dictionary
def myalgorithm(stock, account, variables):
    # keep track of highs and lows
    if stock["price"] &gt; variables["high"]:
        variables["high"] = stock["price"]

    if stock["price"] &lt; variables["low"]:
        variables["low"] = stock["price"]

    # buy stock if not owned
    if (stock["ticker"] not in account.stocks_owned) and (account.funds - (stock["price"] + account.TRANSACTION_FEE) &gt;= 0):
        account.buy_stock(stock["ticker"], 1)

# backtest algorithm
backtester.simulate(myalgorithm)

# print report of account
account.report()
</code></pre>

<h1 id="contributing">Contributing</h1>

<p>PyAlgosim is completely opensource, licensed under the <a href="https://opensource.org/licenses/MIT">MIT License</a>. If you find any bugs, or have new ideas to extend the software, please do! Create a new issue or pull request and it will be reviewed.</p>

        </div>

      </div>
    </div>
  </div>

  <footer id="footer">
    <div class="container">
      <div class="row">

        <div class="col s12">
          <ul>
            <li>
              <a href="getting-started.html">Getting started</a>
            </li>
            <li>
              <a href="docs.html">Documentation</a>
            </li>
            <li>
              <a href="https://github.com/DHDaniel/PyAlgosim/releases/latest">Download</a>
            </li>
          </ul>
        </div>
        <div class="col s12">
          <p id="copyright">
            Copyright (c) 2017 Daniel Hernández under the <a href="https://opensource.org/licenses/MIT">MIT License</a>.
          </p>
        </div>

      </div>
    </div>
  </footer>


    <script src="js/jquery-2.2.0.js" type="text/javascript"></script>
    <script src="js/materialize.min.js" type="text/javascript"></script>

    <!-- Loading and initializing syntax highlighter -->
    <script src="js/highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script src="js/TweenMax.min.js" type="text/javascript"></script>
    <script src="js/scrollmagic/uncompressed/ScrollMagic.js" type="text/javascript"></script>
    <script src="js/scrollmagic/uncompressed/plugins/animation.gsap.js" type="text/javascript"></script>
    <script src="js/scrollmagic/uncompressed/plugins/debug.addIndicators.js" type="text/javascript"></script>
    <script src="js/main.js" type="text/javascript"></script>
</body>

</html>
